<!DOCTYPE html>
<head>
	<title>Teamspeak Server Remote</title>
	<meta charset="utf-8"/>
	<link rel="icon"href="https://img.rankedboost.com/wp-content/uploads/2014/09/Season_2019_-_Challenger_1.png" type=image/x-icon>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
	
	<style>
		

		* {
			margin: 0;
			padding: 0;
			font-family: 'Arial';
			box-sizing: border-box;
		}

		body {
			width: 100%;
			height: 100%;
			position: relative;
			color: rgb(255, 255, 255);
			background-color: rgb(68, 79, 83);
		}

		hr {
			background-color: #FFFFFF;
			height: 1px;
		}

		#clienttable {
			border: 1px solid black;
			border-collapse: collapse;
		}

		.ChannelCell {
			border: 1px solid black;
			padding: 5px;
		}

		.ClientCell {
			border: 1px solid black;
			padding: 5px;
		}

		.title-1 {
			font-size: 32px;
			font-weight: bold;
		}

		#container {
			padding: 32px;
		}

		li {
			margin-left: 12px;
			padding: 4px;
			font-weight: normal;
			font-size: 16px;
		}

		ul {
			list-style: none;
			font-weight: bold;
			font-size: 18px;
		}

		#text {
			position: absolute;
			left: 50%;
			top: 50%;
			text-align: center;
			transform: translate(-50%, -50%);
		}

		#header {
			position: relative;
			height: 75px;
		}

		#motd {
			position: absolute;
			max-width: 200px;
			transform-origin: 50% 50%;
			transform: rotate(15deg);
			color: #fffc46;
			animation: pulse 0.75s ease-in infinite alternate;
		}

		#server-interface {
			display: flex;
		}

		#server-interface > div {
			flex: 1;
		}

		#list-container {

		}

		#chat-container > textarea {
			width: 100%;
			height: 200px;
			
		}

		#chat-container > div {
			display: flex;
		}

		#chat-container > div > input {
			flex: 4;
		}

		#chat-container > div > button {
			flex: 0.5;
		}

		@keyframes pulse {
			from {transform: scale(1,1) rotate(15deg)}
			to {transform: scale(1.15,1.15) rotate(15deg)}
		}

		

	</style>
</head>

<body>

	<div id="container">

		<div id="header">
			<div id="text">
				<div class="title-1">CNap's, Buddies, and Friends Webserver</div>
				
				<p>Make sure to check out Jason's <a href="http://74.88.193.161:8081">website</a></p>

				<div id="motd">Put a randomly returned message here for fun</div>
			</div>
		</div>

		<div id="server-interface">
			<div id="list-container">
				<h2>Who is online?</h2>

				<div id="channels"></div>
			</div>
			<div id="chat-container">
				<h2>Chat with the boys</h2>
				<textarea id="chat-log" readonly="readonly" ></textarea>
				<br>
				<div>
					<input id="chat-input" type="text" placeholder="Type message...">
					<button id="chat-send">Send</button>
				</div>
			</div>

		</div>
		<hr>
		<h2>Who is online the most?</h2>
		<h4>Coming soon...</h3>

		<script defer>
			const ChatLog = document.getElementById("chat-log")
			const ChatInput = document.getElementById("chat-input")
			const ChannelList = document.getElementById("channels")
			const ChatSend = document.getElementById("chat-send")

			/* Use this to change the pulsing message (Motd.innerText = [message]) */
			const Motd = document.getElementById("motd")

			let socket = new WebSocket("ws://" + document.location.host + "/ws");
			let debug = false

			ChatSend.addEventListener("click", () => {

				let text = ChatInput.value

				let message = {
					ip: "blah.blah.blah", // Todo: get IP
					message: text,
					time: "69:69 PM" // Todo: get time - I'm lazy af
				}

				let json = JSON.stringify(message)

				let data = {
					header: "chatmessage",
					payload: message
				}

				socket.send(data)

				ChatLog.append(`${text}\n`) // probably comment this out once server communication is set up
				ChatLog.scrollTop = ChatLog.scrollHeight;
			})

			socket.onmessage = event => {
				let msg = JSON.parse(event.data)
				if (debug) {
					for (var chans = 0; chans < msg.data.length; chans++) {
						var currChan = msg.data[chans].Clients
						console.log(msg.data[chans].ChannelName)
						for (var clients = 0; clients < currChan.length; clients++) {
							console.log(currChan[clients])
						}
					}
				}
				updateTable(msg.data)
			}

			socket.onopen = () => {
				console.log("Successfully Connected");
			};

			socket.onclose = event => {
				console.log("Socket Closed Connection: ", event);
			};

			socket.onerror = error => { };

			function updateTable(clientListData) {
				let html = "";

				for(let item of clientListData) {
					html += `<ul class="list-channels">${item.ChannelName}`;
					/* Start inserting clients */
					html += "<li><ul class='list-clients'>";
					for (let client of item.Clients) {
						html += `<li>${client}</li>`
					}
					html += '</ul></ul>'
				}

				ChannelList.innerHTML = html
			}

		</script>

	</div>
	<canvas id="ltcChart" style="width:100%"></canvas>
	<!-- <script>
		new Chart("ltcChart", {
			type: "pie",
			data: {
				labels: [
					{{ range $clientEntry := .ClientTimeEntries }}
						'{{ $clientEntry.ClientName }}',
					{{ end }}
				],
				datasets: [{
					data: [
					{{ range $clientEntry := .ClientTimeEntries }}
						'{{ $clientEntry.TotalTime }}',
					{{ end }}
					],
					backgroundColor: ["red", "blue", "green", "yellow", "purple"],
					hoverOffset: 4,
				}]
			},
		});
	</script> -->
</body>
