<!DOCTYPE html>
<head>
	<title>Teamspeak Server Remote</title>
	<meta charset="utf-8"/>
	<link rel="icon"
		href="https://img.rankedboost.com/wp-content/uploads/2014/09/Season_2019_-_Challenger_1.png"
		type=image/x-icon>
	<style>
		*,
		html {
			margin: 2;
			padding: 0;
			border: 0;
			font-family: 'Arial';
		}

		body {
			width: 100%;
			height: 100%;
			position: relative;
			color: rgb(255, 255, 255);
			background-color: rgb(68, 79, 83);
		}

		hr {
			border: 0;
			clear: both;
			display: block;
			width: 95%;
			background-color: #FFFFFF;
			height: 1px;
		}

		#clienttable {
			border: 1px solid black;
			border-collapse: collapse;
		}

		.ChannelCell {
			border: 1px solid black;
			padding: 5px;
		}

		.ClientCell {
			border: 1px solid black;
			padding: 5px;
		}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>

<body>
	<center>
		<h1>CNap's, Buddies, and Friends Webserver</h1>
		<h2>Make sure to check out Jason's <a href="http://74.88.193.161:8081">website</a></h2>
	</center>
	<h2>Who is online?</h2>
	<table id="clienttable"></table>
	<script>
		$(document).ready(function() {
		let socket = new WebSocket("ws://" + document.location.host + "/ws");
		let debug = false

		socket.onmessage = event => {
			let msg = JSON.parse(event.data)
			if (debug) {
				for (var chans = 0; chans < msg.data.length; chans++) {
					var currChan = msg.data[chans].Clients
					console.log(msg.data[chans].ChannelName)
					for (var clients = 0; clients < currChan.length; clients++) {
						console.log(currChan[clients])
					}
				}
			}
			updateTable(msg.data)
		}

		socket.onopen = () => {
			console.log("Successfully Connected");
		};

		socket.onclose = event => {
			console.log("Socket Closed Connection: ", event);
		};

		socket.onerror = error => { };

		function updateTable(clientListData) {
			var rows = '<tr><th>Channels</th><th>Clients</th></tr>';
			$.each(clientListData, function(index, item) {
				var row = '<tr class="ChannelCell">';
				row += '<td class="ChannelCell">' + item['ChannelName'] + '</td>';
				/* Start inserting clients */
				row += '<td>';
				for (var i = 0; i < item['Clients'].length; i++) {
					row += item['Clients'][i] + ' ';
				}
				row += '</td>'
				if (debug)
					console.log(row)
				rows += row + '</tr>'
			});
			$(clienttable).html(rows)
		}
		});

	</script>
	<hr>
	<h2>Who is online the most?</h2>
	<h4>Coming soon...</h3>
	<canvas id="ltcChart" style="width:100%"></canvas>
	<script>
		new Chart("ltcChart", {
			type: "pie",
			data: {
				labels: [
					{{ range $clientEntry := .ClientTimeEntries }}
						'{{ $clientEntry.ClientName }}',
					{{ end }}
				],
				datasets: [{
					data: [
					{{ range $clientEntry := .ClientTimeEntries }}
						'{{ $clientEntry.TotalTime }}',
					{{ end }}
					],
					backgroundColor: ["red", "blue", "green", "yellow", "purple"],
					hoverOffset: 4,
				}]
			},
		});
	</script>
</body>
